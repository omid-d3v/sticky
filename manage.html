<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ù…Ø¯ÛŒØ±ÛŒØª ØªØ®ØªÙ‡ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ ØªØ¨Ø±ÛŒÚ©</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css">
  <style>
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding-top: 20px;
      min-height: 100vh;
      background-image: url('https://www.transparenttextures.com/patterns/padded-light.png'), linear-gradient(to top left, #a1c4fd, #c2e9fb);
      background-attachment: fixed;
    }
    .page-container {
        width: 95%;
        max-width: 800px;
        margin: 0 auto;
    }
    .board-selector-container, .form-container, #admin-notes-list-container {
      background: rgba(255, 255, 255, 0.95);
      padding: 25px 30px;
      border-radius: 15px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
      width: 100%;
      margin-bottom: 30px;
    }
    .section-title {
      text-align: center;
      color: #3f51b5;
      margin-bottom: 25px;
      font-size: 1.8rem;
    }
    #board-selector-form label {
        display: block;
        margin-bottom: 10px;
        font-weight: bold;
    }
    #board-selector-form input[type="text"] {
        width: calc(100% - 130px); /* Adjusted for button width */
        padding: 10px;
        border-radius: 5px;
        border: 1px solid #ccc;
        font-family: 'Vazirmatn', sans-serif;
    }
    #board-selector-form button {
        padding: 10px 15px;
        background-color: #5cb85c;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        margin-right: 10px; /* RTL: margin-left */
    }
     #current-board-info {
        text-align: center;
        margin-bottom: 20px;
        padding: 10px;
        background-color: #e3f2fd;
        border: 1px solid #90caf9;
        border-radius: 8px;
    }
    #current-board-info a {
        color: #1976d2;
        text-decoration: none;
        font-weight: bold;
    }
    #current-board-info a:hover {
        text-decoration: underline;
    }
    .main-footer {
        text-align: center;
        padding: 20px;
        margin-top: 10px;
        font-family: 'Vazirmatn', sans-serif;
        color: #555;
        font-size: 0.9rem;
    }
    #admin-notes-list-container { margin-top: 0; }
    .admin-note-item {
        border: 1px solid #eee; background-color: #fff; padding: 15px; margin-bottom: 15px;
        border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); display: flex;
        flex-direction: column; gap: 8px;
    }
    .admin-note-item .note-content { flex-grow: 1; }
    .admin-note-item .note-name { font-weight: bold; color: #3f51b5; font-size: 1.1rem; }
    .admin-note-item .note-message { font-size: 0.95rem; color: #555; white-space: pre-wrap; }
    .admin-note-item .note-image-url { font-size: 0.8rem; color: #777; word-break: break-all; }
    .admin-note-item .note-actions button {
        padding: 6px 12px; margin-left: 8px; border: none;
        border-radius: 5px; cursor: pointer; font-size: 0.9rem; transition: opacity 0.2s ease;
    }
    .admin-note-item .note-actions button:hover { opacity: 0.8; }
    .edit-button { background-color: #ffc107; color: #333; }
    .delete-button { background-color: #f44336; color: white; }
    .cancel-edit-button { background-color: #9e9e9e; color: white; display: none; margin-top: 10px;}
    #message-box {
        margin-top: 15px; padding: 10px; border-radius: 5px; text-align: center;
        font-weight: bold; display: none; 
    }
    #message-box.success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    #message-box.error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
  </style>
</head>
<body>
  <div class="page-container">
    <div class="board-selector-container" id="board-selector-wrapper">
        <h1 class="section-title">Ø§Ù†ØªØ®Ø§Ø¨ ÛŒØ§ Ø§ÛŒØ¬Ø§Ø¯ ØªØ®ØªÙ‡ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª</h1>
        <form id="board-selector-form">
            <label for="boardIdInput">Ø´Ù†Ø§Ø³Ù‡ ØªØ®ØªÙ‡ (Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒØŒ Ø¨Ø¯ÙˆÙ† ÙØ§ØµÙ„Ù‡ØŒ Ù…Ø«Ù„Ø§: tavalod-ali-1403):</label>
            <input type="text" id="boardIdInput" placeholder="Ø´Ù†Ø§Ø³Ù‡ ØªØ®ØªÙ‡ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯" />
            <button type="submit">Ø¨Ø±Ùˆ Ø¨Ù‡ Ø§ÛŒÙ† ØªØ®ØªÙ‡ / Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù†</button>
        </form>
    </div>

    <div id="board-management-area" style="display:none;">
        <div id="current-board-info"></div>
        <div class="form-container">
          <h1 class="section-title" id="form-main-title">ğŸ’Œ Ø§ÙØ²ÙˆØ¯Ù† Ù¾ÛŒØ§Ù… Ø¨Ù‡ ØªØ®ØªÙ‡ ğŸ’Œ</h1>
          <form id="note-form">
            <input type="hidden" id="noteId" />
            <div class="form-group">
              <label for="name">Ù†Ø§Ù… Ø´Ù…Ø§:</label>
              <input type="text" id="name" placeholder="Ù…Ø«Ù„Ø§: Ø¨Ù‡ØªØ±ÛŒÙ† Ø¯ÙˆØ³Øª" required />
            </div>
            <div class="form-group">
              <label for="message">Ù¾ÛŒØ§Ù… ØªØ¨Ø±ÛŒÚ©:</label>
              <textarea id="message" placeholder="ÛŒÙ‡ Ø¹Ø§Ù„Ù…Ù‡ Ø¢Ø±Ø²ÙˆÛŒ Ø®ÙˆØ¨..." rows="4" required></textarea>
            </div>
            <div class="form-group">
              <label for="imageURL">Ù„ÛŒÙ†Ú© Ø¹Ú©Ø³ Ù¾Ø±ÙˆÙØ§ÛŒÙ„ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ):</label>
              <input type="url" id="imageURL" placeholder="https://example.com/avatar.jpg" />
              <small>ÛŒÚ© Ù„ÛŒÙ†Ú© Ù…Ø³ØªÙ‚ÛŒÙ… Ø¨Ù‡ ÙØ§ÛŒÙ„ Ø¹Ú©Ø³ (png, jpg, gif)</small>
            </div>
            <button type="submit" id="submit-button">Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… âœ¨</button>
            <button type="button" id="cancel-edit-button" class="cancel-edit-button">Ù„ØºÙˆ ÙˆÛŒØ±Ø§ÛŒØ´</button>
          </form>
          <div id="message-box"></div>
        </div>

        <div id="admin-notes-list-container">
          <h2 style="text-align:center; color: #3f51b5; margin-bottom: 20px;" id="list-title">Ù„ÛŒØ³Øª Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§</h2>
          <div id="admin-notes-list"></div>
        </div>
    </div>
  </div>
  
  <footer class="main-footer">
    Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯Ù‡ Ø¨Ø§ Ø¹Ø´Ù‚ ØªÙˆØ³Ø· Ø§Ù…ÛŒØ¯ Ùˆ Ù…Ù‡Ù„Ø§ â¤ï¸
  </footer>

  <script type="module">
    // ! Ù…Ù‡Ù…: Ø§ÛŒÙ† Ø¢Ø¯Ø±Ø³ Ø±Ø§ Ø¨Ø§ Ø¢Ø¯Ø±Ø³ Ø³Ø±ÙˆØ± Ù¾Ø±ÙˆÚ©Ø³ÛŒ Ø®ÙˆØ¯ Ø¯Ø± Railway Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ú©Ù†ÛŒØ¯
    const PROXY_BASE_URL = 'https://sticky-proxyserver-production.up.railway.app/api'; // Ù…Ø«Ø§Ù„: 'https://my-notes-proxy.up.railway.app/api'
                                                                      // /api Ø±Ø§ Ø¨Ù‡ Ø§Ù†ØªÙ‡Ø§ÛŒ Ø¢Ø¯Ø±Ø³ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯

    const boardSelectorForm = document.getElementById('board-selector-form');
    const boardIdInputField = document.getElementById('boardIdInput');
    const boardSelectorWrapper = document.getElementById('board-selector-wrapper');
    const boardManagementArea = document.getElementById('board-management-area');
    const currentBoardInfoDiv = document.getElementById('current-board-info');
    
    const noteForm = document.getElementById('note-form');
    const submitButton = document.getElementById('submit-button');
    const cancelEditButton = document.getElementById('cancel-edit-button');
    const messageBox = document.getElementById('message-box');
    const noteIdField = document.getElementById('noteId'); // This is the hidden input
    const nameField = document.getElementById('name');
    const messageField = document.getElementById('message');
    const imageURLField = document.getElementById('imageURL');
    const adminNotesListDiv = document.getElementById('admin-notes-list');
    const formMainTitle = document.getElementById('form-main-title');
    const listTitle = document.getElementById('list-title');

    let activeBoardId = null;
    let currentEditId = null; // Stores the ID of the note being edited

    function getBoardIdFromURL() {
        const params = new URLSearchParams(window.location.search);
        return params.get('boardId');
    }

    function sanitizeBoardId(id) {
        if (!id) return '';
        return id.trim().toLowerCase().replace(/\s+/g, '-').replace(/[^a-z0-9-]/g, '');
    }

    boardSelectorForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const inputBoardId = boardIdInputField.value;
        const sanitizedBoardId = sanitizeBoardId(inputBoardId);
        if (sanitizedBoardId) {
            window.location.search = `?boardId=${sanitizedBoardId}`;
        } else {
            showMessage('Ù„Ø·ÙØ§Ù‹ ÛŒÚ© Ø´Ù†Ø§Ø³Ù‡ Ù…Ø¹ØªØ¨Ø± Ø¨Ø±Ø§ÛŒ ØªØ®ØªÙ‡ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.', 'error');
        }
    });

    function initializeBoard(boardId) {
        activeBoardId = boardId;
        boardSelectorWrapper.style.display = 'none';
        boardManagementArea.style.display = 'block';

        const publicViewLink = `index.html?boardId=${activeBoardId}`;
        currentBoardInfoDiv.innerHTML = `
            Ø´Ù…Ø§ Ø¯Ø± Ø­Ø§Ù„ Ù…Ø¯ÛŒØ±ÛŒØª ØªØ®ØªÙ‡: <strong>${activeBoardId}</strong> Ù‡Ø³ØªÛŒØ¯. <br>
            <a href="${publicViewLink}" target="_blank">Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¹Ù…ÙˆÙ…ÛŒ Ø§ÛŒÙ† ØªØ®ØªÙ‡</a> | 
            <a href="manage.html">Ø§Ù†ØªØ®Ø§Ø¨ ØªØ®ØªÙ‡ Ø¯ÛŒÚ¯Ø±</a>
        `;
        formMainTitle.textContent = `ğŸ’Œ Ø§ÙØ²ÙˆØ¯Ù† Ù¾ÛŒØ§Ù… Ø¨Ù‡ ØªØ®ØªÙ‡ "${activeBoardId}" ğŸ’Œ`;
        listTitle.textContent = `Ù„ÛŒØ³Øª Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ ØªØ®ØªÙ‡ "${activeBoardId}"`;
        
        resetForm();
        loadNotesForAdmin();
    }
    
    function showMessage(message, type = "success", targetMessageBox = messageBox) {
      targetMessageBox.textContent = message;
      targetMessageBox.className = `message-box ${type}`; // Ensure base class is there
      targetMessageBox.style.display = 'block';
      setTimeout(() => {
        targetMessageBox.style.display = 'none';
      }, 4000);
    }

    function resetForm() {
        noteForm.reset();
        noteIdField.value = ''; // Clear the hidden ID field
        currentEditId = null;
        submitButton.textContent = 'Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… âœ¨';
        if (activeBoardId) { // Update title only if a board is active
            formMainTitle.textContent = `ğŸ’Œ Ø§ÙØ²ÙˆØ¯Ù† Ù¾ÛŒØ§Ù… Ø¨Ù‡ ØªØ®ØªÙ‡ "${activeBoardId}" ğŸ’Œ`;
        } else {
            formMainTitle.textContent = 'ğŸ’Œ Ù¾ÛŒØ§Ù…Øª Ø±Ùˆ Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ù†ÙˆÛŒØ³! ğŸ’Œ';
        }
        cancelEditButton.style.display = 'none';
        submitButton.disabled = false;
    }

    noteForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      if (!activeBoardId) {
          showMessage('Ø§Ø¨ØªØ¯Ø§ ÛŒÚ© ØªØ®ØªÙ‡ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ ÛŒØ§ Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù†ÛŒØ¯.', 'error');
          return;
      }
      const name = nameField.value.trim();
      const message = messageField.value.trim();
      const imageURL = imageURLField.value.trim();
      const noteData = { name, message, imageURL: imageURL || null };

      if (name && message) {
        submitButton.disabled = true;
        let url, method;

        if (currentEditId) { // UPDATE
          url = `${PROXY_BASE_URL}/notes/${activeBoardId}/${currentEditId}`;
          method = 'PUT';
          submitButton.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ...';
        } else { // ADD
          url = `${PROXY_BASE_URL}/notes/${activeBoardId}`;
          method = 'POST';
          submitButton.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„...';
        }

        try {
          const response = await fetch(url, {
            method: method,
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(noteData)
          });
          
          if (!response.ok) {
            const errorData = await response.json().catch(() => ({error: "Ø®Ø·Ø§ÛŒ Ù†Ø§Ø´Ù†Ø§Ø®ØªÙ‡ Ø¯Ø± Ù¾Ø§Ø³Ø® Ø³Ø±ÙˆØ±"}));
            throw new Error(errorData.error || `Ø®Ø·Ø§ÛŒ Ø³Ø±ÙˆØ±: ${response.status}`);
          }
          
          // const result = await response.json(); // The proxy sends back the note or a success message
          showMessage(currentEditId ? 'Ù¾ÛŒØ§Ù… Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯! ğŸ‘' : 'Ù¾ÛŒØ§Ù… Ø´Ù…Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯! ğŸ‰', 'success');
          resetForm();
          loadNotesForAdmin(); // Refresh list after add/update
        } catch (error) {
          console.error("Error saving document via proxy: ", error);
          showMessage(`Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ù¾ÛŒØ§Ù…: ${error.message}`, 'error');
          submitButton.disabled = false;
          submitButton.textContent = currentEditId ? 'Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù¾ÛŒØ§Ù… ğŸ”„' : 'Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… âœ¨';
        }
      } else {
        showMessage('Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ùˆ Ù¾ÛŒØ§Ù… Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.', 'error');
      }
    });

    cancelEditButton.addEventListener('click', () => {
        resetForm();
        window.scrollTo({ top: 0, behavior: 'smooth' });
    });

    async function loadNotesForAdmin() {
        if (!activeBoardId) return;
        adminNotesListDiv.innerHTML = `<p style="text-align:center; color:#777;">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ ØªØ®ØªÙ‡ "${activeBoardId}"...</p>`;
        try {
            const response = await fetch(`${PROXY_BASE_URL}/notes/${activeBoardId}`);
            if (!response.ok) {
                const errorData = await response.json().catch(() => ({error: "Ø®Ø·Ø§ÛŒ Ù†Ø§Ø´Ù†Ø§Ø®ØªÙ‡"}));
                throw new Error(errorData.error || `Ø®Ø·Ø§ÛŒ Ø³Ø±ÙˆØ±: ${response.status}`);
            }
            const notes = await response.json();
            adminNotesListDiv.innerHTML = ''; // Clear loading message
            if (!notes || notes.length === 0) {
                adminNotesListDiv.innerHTML = `<p style="text-align:center; color:#777;">Ù‡Ù†ÙˆØ² Ù¾ÛŒØ§Ù…ÛŒ Ø¨Ø±Ø§ÛŒ ØªØ®ØªÙ‡ "${activeBoardId}" Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</p>`;
                return;
            }
            notes.forEach(note => createAdminNoteElement(note, note.id));
        } catch (error) {
            console.error(`Error fetching notes for admin (board: ${activeBoardId}): `, error);
            showMessage(`Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù„ÛŒØ³Øª Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§: ${error.message}`, "error");
            adminNotesListDiv.innerHTML = `<p style="text-align:center; color:red;">Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§. ${error.message}</p>`;
        }
    }

    function createAdminNoteElement(note, noteId) {
        const item = document.createElement('div');
        item.classList.add('admin-note-item');
        item.dataset.id = noteId;
        
        const contentDiv = document.createElement('div');
        contentDiv.classList.add('note-content');
        const nameEl = document.createElement('div');
        nameEl.classList.add('note-name'); nameEl.textContent = note.name; contentDiv.appendChild(nameEl);
        const messageEl = document.createElement('div');
        messageEl.classList.add('note-message'); messageEl.textContent = note.message; contentDiv.appendChild(messageEl);
        if (note.imageURL) {
            const imageEl = document.createElement('div');
            imageEl.classList.add('note-image-url'); imageEl.innerHTML = `<strong>Ù„ÛŒÙ†Ú© Ø¹Ú©Ø³:</strong> ${note.imageURL}`; contentDiv.appendChild(imageEl);
        }
        // Timestamps from Firestore are objects, need to convert if they exist and are valid
        let formattedTimestamp = 'Ù†Ø§Ù…Ø´Ø®Øµ';
        if (note.timestamp && note.timestamp._seconds) { // Firestore timestamp object from Admin SDK
             formattedTimestamp = new Date(note.timestamp._seconds * 1000).toLocaleString('fa-IR');
        } else if (typeof note.timestamp === 'string' && note.timestamp.includes("Pending")) {
            formattedTimestamp = "Ø¯Ø±Ø­Ø§Ù„ Ø«Ø¨Øª ØªÙˆØ³Ø· Ø³Ø±ÙˆØ±";
        } else if (note.timestamp) { // If it's already a string or number from a previous fetch
            try { formattedTimestamp = new Date(note.timestamp).toLocaleString('fa-IR'); } catch (e) { /* ignore */ }
        }

        const timestampEl = document.createElement('div');
        timestampEl.style.fontSize = '0.8rem'; timestampEl.style.color = '#888';
        timestampEl.textContent = `ØªØ§Ø±ÛŒØ®: ${formattedTimestamp}`; contentDiv.appendChild(timestampEl);
        item.appendChild(contentDiv);

        const actionsDiv = document.createElement('div'); actionsDiv.classList.add('note-actions');
        const editButton = document.createElement('button');
        editButton.classList.add('edit-button'); editButton.textContent = 'ÙˆÛŒØ±Ø§ÛŒØ´';
        editButton.addEventListener('click', () => {
            formMainTitle.textContent = `ğŸ“ ÙˆÛŒØ±Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… Ø¯Ø± ØªØ®ØªÙ‡ "${activeBoardId}" ğŸ“`;
            nameField.value = note.name; messageField.value = note.message; imageURLField.value = note.imageURL || '';
            noteIdField.value = noteId; currentEditId = noteId; // Set currentEditId
            submitButton.textContent = 'Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù¾ÛŒØ§Ù… ğŸ”„'; cancelEditButton.style.display = 'inline-block';
            window.scrollTo({ top: 0, behavior: 'smooth' }); nameField.focus();
        });

        const deleteButton = document.createElement('button');
        deleteButton.classList.add('delete-button'); deleteButton.textContent = 'Ø­Ø°Ù';
        deleteButton.addEventListener('click', async () => {
            // Custom confirmation dialog
            const modal = document.createElement('div');
            modal.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:1000;direction:rtl;';
            const modalContent = document.createElement('div');
            modalContent.style.cssText = "background-color:white;padding:20px;border-radius:8px;text-align:center;font-family:'Vazirmatn',sans-serif;";
            const messageP = document.createElement('p');
            messageP.textContent = `Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ù¾ÛŒØ§Ù… "${note.name}" Ø§Ø² ØªØ®ØªÙ‡ "${activeBoardId}" Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`; messageP.style.marginBottom = '20px'; modalContent.appendChild(messageP);
            const confirmBtn = document.createElement('button');
            confirmBtn.textContent = 'Ø¨Ù„Ù‡ØŒ Ø­Ø°Ù Ú©Ù†'; confirmBtn.style.cssText = 'background-color:#f44336;color:white;border:none;padding:10px 15px;border-radius:5px;margin-left:10px;cursor:pointer;';
            const cancelBtn = document.createElement('button');
            cancelBtn.textContent = 'Ø§Ù†ØµØ±Ø§Ù'; cancelBtn.style.cssText = 'background-color:#ccc;border:none;padding:10px 15px;border-radius:5px;cursor:pointer;';
            
            confirmBtn.onclick = async () => {
                document.body.removeChild(modal);
                try {
                    const response = await fetch(`${PROXY_BASE_URL}/notes/${activeBoardId}/${noteId}`, { method: 'DELETE' });
                    if (!response.ok) {
                        const errorData = await response.json().catch(() => ({error: "Ø®Ø·Ø§ÛŒ Ù†Ø§Ø´Ù†Ø§Ø®ØªÙ‡"}));
                        throw new Error(errorData.error || `Server error: ${response.status}`);
                    }
                    showMessage('Ù¾ÛŒØ§Ù… Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø­Ø°Ù Ø´Ø¯.', 'success');
                    loadNotesForAdmin(); // Refresh list
                } catch (error) { 
                    console.error("Error deleting document via proxy: ", error); 
                    showMessage(`Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ù¾ÛŒØ§Ù…: ${error.message}`, 'error'); 
                }
            };
            cancelBtn.onclick = () => { document.body.removeChild(modal); };
            modalContent.appendChild(confirmBtn); modalContent.appendChild(cancelBtn);
            modal.appendChild(modalContent); document.body.appendChild(modal);
        });
        actionsDiv.appendChild(editButton); actionsDiv.appendChild(deleteButton); item.appendChild(actionsDiv);
        adminNotesListDiv.appendChild(item);
    }

    const initialBoardIdFromUrl = getBoardIdFromURL();
    if (initialBoardIdFromUrl) {
        const sanitizedInitialId = sanitizeBoardId(initialBoardIdFromUrl);
        boardIdInputField.value = sanitizedInitialId; // Pre-fill for clarity
        initializeBoard(sanitizedInitialId);
    } else {
        boardSelectorWrapper.style.display = 'block';
        boardManagementArea.style.display = 'none';
    }
  </script>
</body>
</html>
